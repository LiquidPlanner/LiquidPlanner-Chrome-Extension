<html>
<head>
<title>LiquidChrome Options</title>
<link rel="stylesheet" href="/style.css" type="text/css" charset="utf-8">
<script src='jquery-1.4.1.js'></script>
<script src='liquid_chrome.js'></script>

<script type="text/javascript">

function showWorkSpaces(spaces, status) {
  var html = $('#workspaces');
  var currentId = LiquidChrome.defaults.url.space_id;
  
  for (var i = 0, space; space = spaces[i]; i++) {
    var opt = $('<option>').attr('value', space.id).text(space.name);
    if(space.id == currentId){opt.attr('selected', 'selected');}
    html.append(opt);
  }
  
  updateSpaceId();
}

function updateSpaceId(){
  var spaceId = $('#workspaces').val();
  LiquidChrome.defaults.url.space_id = spaceId;
  LiquidChrome.saveOptions();
}

function saveIntegerOption(name){
  return function(){
    var input = $('#'+name);
    var val = parseInt(input.val(),10);
    val = val > 0 ? val : 0;
    input.val(val);
    
    LiquidChrome.defaults[name] = val;
    LiquidChrome.saveOptions();
  };
}

function saveBooleanOption(name){
  return function(){
    var input = $('#'+name);
    var val = input.attr('checked')

    LiquidChrome.defaults[name] = val;
    LiquidChrome.saveOptions();
  };
}

$(document).ready(function(){
  $('#error').ajaxError(function(event, request, settings){
    // unlike popup.html, options.html should have no issue with prompting for credentials
    $(this).html("Could not load LiquidPlanner data").show();
  });
  
  LiquidChrome.workspaces({success: showWorkSpaces});
  $('#workspaces').change(updateSpaceId);
  // Setup serializing and deserializing advanced options
  $('#commentCount').val(LiquidChrome.defaults.commentCount).change(saveIntegerOption('commentCount'));
  $('#doneCount').val(LiquidChrome.defaults.doneCount).change(saveIntegerOption('doneCount'));
  $('#pendingCount').val(LiquidChrome.defaults.pendingCount).change(saveIntegerOption('pendingCount'));
  $('#showAllComments').attr('checked', LiquidChrome.defaults.showAllComments).change(saveBooleanOption('showAllComments'));
  
  // Hook up page controls
  $('#showAdvancedOptions').click(function(){ $(this).hide(); $('#advancedOptions').toggle('slide'); });
  $('#resetOptions').click(function(){
    var ok = confirm("Are your sure you want to reset your settings?")
    if(ok){LiquidChrome.resetOptions();}
    return ok;
  });
});

</script>
</head>
<body id='options'>

<h1>LiquidChrome Options</h1>
<form>
  <div class='option'>
    <label>Use Workspace: <select id="workspaces"></select></label>
    <p class='info'>
      This workspace will be used to list tasks on the LiquidChrome menu (<img src='icon.png'/>)
    </p>
  </div>

  <br/>
  <a href='#' id='showAdvancedOptions'>Advanced options...</a>
  <div id='advancedOptions' style='display: none'>
    <p class='info'>
      And by advanced, we really mean options that should work fine the way they are.
    </p>
    
    <fieldset>
      <legend>Comments</legend>
      <div class='option'>
        <label>Show <input type='text' id="commentCount"/> comments</label>
      </div>
      <div class='option'>
        <label><input type='checkbox' id="showAllComments">Show comments for all users</label>
      </div>
    </fieldset>
    
    <fieldset>
      <legend>Tasks</legend>
      <div class='option'>
        <label>Show <input type='text' id="pendingCount"/> upcoming items</label>
      </div>
      <div class='option'>
        <label>Show <input type='text' id="doneCount"/> done items</label>
      </div>
    </fieldset>
    
    <br/>
    <div class='option'>
      <a id='resetOptions' href='options.html'>Reset to defaults</a>
    </div>
  </div>
</form>
<div id='message' class='info'></div>
<div id='error'   class='error'></div>
</body>
</html>