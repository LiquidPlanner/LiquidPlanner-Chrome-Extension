<html>
<head>
<title>LiquidChrome Options</title>
<link rel="stylesheet" href="/style.css" type="text/css" charset="utf-8">
<script src='jquery-1.3.1.js'></script>
<script src='liquid_chrome.js'></script>

<script type="text/javascript">

function showError(req, status, err) {  
  $(document.body).append('Could not access LiquidPlanner.');
}

function showWorkSpaces(spaces, status) {
  var html = $('#workspaces');
  var currentId = LiquidChrome.defaults.url.space_id;
  
  for (var i = 0, space; space = spaces[i]; i++) {
    var opt = $('<option>').attr('value', space.id).text(space.name);
    if(space.id == currentId){opt.attr('selected', 'selected');}
    html.append(opt);
  }
  
  updateSpaceId();
}

function updateSpaceId(){
  var spaceId = $('#workspaces').val();
  LiquidChrome.defaults.url.space_id = spaceId;
  LiquidChrome.saveOptions();
}

function saveIntegerOption(name){
  return function(){
    var input = $('#'+name);
    var val = parseInt(input.val(),10);
    val = Math.max(0,val);
    input.val(val);
    
    LiquidChrome.defaults[name] = val;
    LiquidChrome.saveOptions();
  };
}

$(document).ready(function(){
  LiquidChrome.workspaces({success: showWorkSpaces, error: showError});
  $('#workspaces').change(updateSpaceId);
  $('#doneCount').val(LiquidChrome.defaults.doneCount).change(saveIntegerOption('doneCount'));
  $('#pendingCount').val(LiquidChrome.defaults.pendingCount).change(saveIntegerOption('pendingCount'));
  $('#showAdvancedOptions').click(function(){ $(this).hide(); $('#advancedOptions').toggle('slide'); });
  $('#resetOptions').click(LiquidChrome.resetOptions);
});

</script>
</head>
<body id='options'>

<h1>LiquidChrome Options</h1>
<div class='option'>
  <label>Use Workspace: <select id="workspaces"></select></label>
  <p class='info'>
    This workspace will be used to list tasks on the LiquidChrome menu (<img src='icon.png'/>)
  </p>
</div>

<br/>
<a href='#' id='showAdvancedOptions'>Advanced options...</a>
<div id='advancedOptions' style='display: none'>
  <p class='info'>
    And by advanced, we really mean options that should work fine the way they are.
  </p>
  <div class='option'>
    <label>Show <input type='text' id="pendingCount"/> upcoming items</label>
  </div>
  <div class='option'>
    <label>Show <input type='text' id="doneCount"/> done items</label>
  </div>

  <br/>
  <div class='option'>
    <a id='resetOptions' href='options.html'>Reset to defaults</a>
  </div>
</div>
</body>
</html>